# GitHub PR Monitor

A lightweight macOS menu bar app that monitors your GitHub pull requests across multiple repos. See PR status at a glance, get notified when things change, and open PRs in your browser with one click.

![macOS only](https://img.shields.io/badge/platform-macOS-lightgrey)

## Features

- **Menu bar icon** with a red notification dot when something needs your attention
- **Tracks PRs you authored** and PRs where **your review is requested**
- **Status indicators** per PR, displayed in aligned columns:

  | Column   | Meaning                                                        |
  |----------|----------------------------------------------------------------|
  | Status   | CI state: green (passing), yellow (pending), red (failing), gray (draft) |
  | Activity | Review/notification state: checkmark (approved), X (changes requested), new, comment |
  | Author   | Who opened the PR                                              |
  | Repo     | Repository name                                                |
  | Title    | PR title                                                       |

- **macOS notifications** when:
  - A new PR appears
  - A PR is approved or has changes requested
  - CI passes or fails
  - New comments are added
- **Polls on a configurable interval** (default: 5 minutes)
- **Persists state** across restarts — no duplicate notifications after reboot
- **Auto-starts on login** via a LaunchAgent (optional)

## Prerequisites

- **macOS** (uses native AppKit for menu bar integration)
- **Python 3** (ships with macOS or install via Homebrew)
- **GitHub CLI (`gh`)** — authenticated with access to your repos

  ```bash
  brew install gh
  gh auth login
  ```

## Installation

```bash
# Clone or download the repo
git clone <repo-url> GithubPRCount
cd GithubPRCount

# Run setup (creates venv, installs dependencies, generates icon, configures repos)
./setup.sh
```

Setup will also offer to install the `ghpr` CLI command (symlink to `/usr/local/bin/ghpr`). You can also create it manually:

```bash
ln -sf "$(pwd)/ghpr" /usr/local/bin/ghpr
```

## Usage — `ghpr` CLI

The `ghpr` command is the primary interface for managing the app:

| Command | Description |
|---------|-------------|
| `ghpr setup` | Check prerequisites, create venv, install deps, configure repos |
| `ghpr start` | Start the menu bar app in the foreground |
| `ghpr install` | Install LaunchAgent for auto-start on login |
| `ghpr uninstall` | Remove the LaunchAgent |
| `ghpr status` | Show whether the daemon is running and current config |
| `ghpr config` | Open config.json in `$EDITOR` (or print it if no editor / not a TTY) |
| `ghpr restart` | Restart the LaunchAgent |

### Quick start

```bash
ghpr setup      # one-time setup
ghpr start      # run manually, or:
ghpr install    # auto-start on login
```

## Usage — shell scripts (alternative)

The individual shell scripts still work if you prefer them:

```bash
./setup.sh      # one-time setup
./run.sh        # start the app
./install.sh    # install LaunchAgent
./uninstall.sh  # remove LaunchAgent
```

## Configuration

Edit `config.json` to customize which repos to watch and how often to poll:

```json
{
  "repos": [
    "your-org/repo-one",
    "your-org/repo-two",
    "another-org/some-repo"
  ],
  "poll_interval_seconds": 300
}
```

Changes to `config.json` are picked up on the next poll — no restart needed.

You can also run `ghpr config` to open the file in your editor.

## Menu bar interaction

- **Click the menu bar icon** to see all your open PRs
- **Click a PR** to open it in your browser
- **"Mark All Seen"** clears the notification dot and per-PR badges
- **"Refresh Now"** forces an immediate poll

## Troubleshooting

**App doesn't appear in menu bar:**
```bash
ghpr status   # check if the LaunchAgent is loaded

# Or check manually:
launchctl list | grep githubprcount

# Check logs
tail -f /tmp/githubprcount.stderr.log
tail -f /tmp/githubprcount.stdout.log
```

**`gh` command not found (when running as LaunchAgent):**

The `run.sh` script adds `/opt/homebrew/bin` and `/usr/local/bin` to PATH. If your `gh` is installed elsewhere, edit the PATH line in `run.sh`.

**No PRs showing up:**

Verify `gh` can list PRs for your repos:
```bash
gh pr list --repo owner/repo-name --author $(gh api user --jq '.login') --state open
```

## Files

| File              | Purpose                                      |
|-------------------|----------------------------------------------|
| `ghpr`            | CLI entrypoint (symlinked to /usr/local/bin) |
| `gh_pr_menu.py`   | Main application                             |
| `config.json`     | Repos to monitor and poll interval           |
| `state.json`      | Persisted state (auto-generated, gitignored) |
| `create_icon.py`  | Generates the menu bar icon                  |
| `github.png`      | Menu bar icon (generated by create_icon.py)  |
| `setup.sh`        | One-time setup (venv, deps, icon)            |
| `run.sh`          | Starts the app                               |
| `install.sh`      | Installs LaunchAgent for auto-start          |
| `uninstall.sh`    | Removes LaunchAgent                          |
| `requirements.txt`| Python dependencies                          |

## License

MIT
