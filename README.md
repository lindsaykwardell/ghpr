# GitHub PR Monitor

A lightweight macOS app that monitors your GitHub pull requests across multiple repos. See PR status at a glance, get notified when things change, and open PRs in your browser with one click.

![macOS only](https://img.shields.io/badge/platform-macOS-lightgrey)

## Features

- **Menu bar icon** with a red notification dot when something needs your attention
- **Tracks PRs you authored** and PRs where **your review is requested**
- **Status indicators** per PR, displayed in aligned columns:

  | Column   | Meaning                                                        |
  |----------|----------------------------------------------------------------|
  | Status   | CI state: green (passing), yellow (pending), red (failing), gray (draft) |
  | Activity | Review/notification state: checkmark (approved), X (changes requested), new, comment |
  | Author   | Who opened the PR                                              |
  | Repo     | Repository name                                                |
  | Title    | PR title                                                       |

- **macOS notifications** when:
  - A new PR appears
  - A PR is approved or has changes requested
  - CI passes or fails
  - New comments are added
- **Polls on a configurable interval** (default: 5 minutes)
- **Persists state** across restarts — no duplicate notifications after reboot
- **Auto-starts on login** via a LaunchAgent

## Prerequisites

- **macOS** (uses native AppKit for menu bar integration)
- **Python 3** (ships with macOS or install via Homebrew)
- **GitHub CLI (`gh`)** — authenticated with access to your repos

  ```bash
  brew install gh
  gh auth login
  ```

## Installation

### One-liner (recommended)

```bash
curl -fsSL https://raw.githubusercontent.com/lindsaykwardell/ghpr/main/install.sh | bash
```

This does everything in one step:
- Clones the repo to `~/.ghpr`
- Sets up the venv and dependencies
- Generates icons
- Links the `ghpr` command to `/usr/local/bin`
- Prompts you to add repos to monitor
- Installs and starts the LaunchAgent

### Manual

```bash
git clone https://github.com/lindsaykwardell/ghpr.git ~/.ghpr
cd ~/.ghpr
./install.sh
```

## Usage — `ghpr` CLI

| Command | Description |
|---------|-------------|
| `ghpr start` | Start the app in the foreground |
| `ghpr config` | Open config.json in `$EDITOR` (or print it if no editor / not a TTY) |
| `ghpr config list` | List monitored repos |
| `ghpr config add owner/repo` | Add a repo to monitor |
| `ghpr config remove owner/repo` | Remove a repo |
| `ghpr status` | Show whether the daemon is running and current config |
| `ghpr restart` | Restart the LaunchAgent |
| `ghpr uninstall` | Full cleanup (LaunchAgent + symlink + ~/.ghpr) |

### Quick start

```bash
# After install, manage repos:
ghpr config add your-org/repo-one
ghpr config add your-org/repo-two
ghpr restart   # pick up new repos immediately
```

## Configuration

Edit `config.json` to customize which repos to watch and how often to poll:

```json
{
  "repos": [
    "your-org/repo-one",
    "your-org/repo-two",
    "another-org/some-repo"
  ],
  "poll_interval_seconds": 300
}
```

Changes to `config.json` are picked up on the next poll — no restart needed.

You can also run `ghpr config` to open the file in your editor, or use `ghpr config add`/`remove` to manage repos from the command line.

## Menu bar interaction

- **Click the menu bar icon** to see all your open PRs (also clears the notification dot)
- **Click a PR** to open it in your browser
- **"Refresh Now"** forces an immediate poll

## Troubleshooting

**App doesn't appear in menu bar:**
```bash
ghpr status   # check if the LaunchAgent is loaded

# Or check manually:
launchctl list | grep githubprcount

# Check logs
tail -f /tmp/githubprcount.stderr.log
tail -f /tmp/githubprcount.stdout.log
```

**`gh` command not found (when running as LaunchAgent):**

The `run.sh` script adds `/opt/homebrew/bin` and `/usr/local/bin` to PATH. If your `gh` is installed elsewhere, edit the PATH line in `run.sh`.

**No PRs showing up:**

Verify `gh` can list PRs for your repos:
```bash
gh pr list --repo owner/repo-name --author $(gh api user --jq '.login') --state open
```

## Files

| File              | Purpose                                      |
|-------------------|----------------------------------------------|
| `ghpr`            | CLI entrypoint (symlinked to /usr/local/bin) |
| `gh_pr_menu.py`   | Main application                             |
| `install.sh`      | Full installer (prereqs, venv, deps, LaunchAgent) |
| `config.json`     | Repos to monitor and poll interval           |
| `state.json`      | Persisted state (auto-generated, gitignored) |
| `create_icon.py`  | Generates the menu bar icon                  |
| `github.png`      | Menu bar icon (generated by create_icon.py)  |
| `run.sh`          | Starts the app (used by LaunchAgent)         |
| `requirements.txt`| Python dependencies                          |

## License

MIT
